---
title: "Blog Post 2"
description: |
  A short description of the post.
preview: images/brazil-flag-waving-mast.jpg
author:
  - name: Lachlan Moody 27809951
    affiliation: Monash University
    affiliation_url: https://www.monash.edu/
date: 09-16-2020
output:
  distill::distill_article:
    self_contained: false
bibliography: biblio.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(tidycovid19)
library(ggplot2)
library(leaflet)
library(maps)
library(plotly)
library(lubridate)
```

## Data Description


## Data Story 1: Spread of COVID19 in South America
```{r regionmap}
tidycovid <- download_merged_data(silent = TRUE, cached = TRUE)

south_america <- tidycovid %>%
  filter(region == "Latin America & Caribbean ") %>%
  group_by(country) %>%
  filter(!is.na(confirmed)) %>%
  summarise(Total_Cases = max(confirmed, na.rm = TRUE),
            population = max(population)) %>%
  mutate(prop = Total_Cases/population*100)

world_map <- map("world", fill = TRUE, plot = FALSE)

cases <- south_america$Total_Cases[match(world_map$names, south_america$country)]

cpal <- colorNumeric("Reds", cases)

leaflet(world_map) %>%
  addProviderTiles("CartoDB.DarkMatter") %>%
  addPolygons(stroke = FALSE,
              smoothFactor = 0.2,
              fillOpacity = 1,color = ~cpal(cases),
              label = paste0(world_map$names, ": ", format(cases, big.mark = ","), " cases")) %>%
  setView(-60, -30, zoom = 2)
```

```{r prop}
prop <- south_america$prop[match(world_map$names, south_america$country)]

cpal2 <- colorNumeric("Reds", prop)

leaflet(world_map) %>%
  addProviderTiles("CartoDB.DarkMatter") %>%
  addPolygons(stroke = FALSE,
              smoothFactor = 0.2,
              fillOpacity = 1,
              color = ~cpal2(prop),
              label = paste0(world_map$names, ": ", round(prop, digits = 2), "% infected")) %>%
  setView(-60, -30, zoom = 2)
```

```{r bar}
top10 <- south_america %>%
  arrange(-Total_Cases) %>%
  top_n(8) %>%
  select(country)

bar_data <- tidycovid %>%
  filter(country %in% top10$country)%>%
  mutate(date = format(date), "%Y-%m-%d") %>%
  mutate(country = as.factor(country)) %>%
  mutate(country = fct_rev(country))

  
bar_data %>%
  plot_ly(
    y = ~country,
    x = ~confirmed,
    frame = ~date,
    type = 'bar',
    color = ~country
  ) %>%
  layout(title = "Change in COVID19 cases over time",
         yaxis = list(title = ""),
         xaxis = list(title = "Total Confirmed Cases"),
         showlegend = FALSE) %>%
  animation_opts(frame = 1) %>%
  animation_button(x = 1, 
                   xanchor = "right", 
                   y = 0, 
                   yanchor = "bottom") %>%
  animation_slider(currentvalue = list(prefix = "Date: ", 
                                       font =list(color="red")))


```

## Data Story 2: Spread of COVID19 in Brazil 

